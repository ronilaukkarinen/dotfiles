#!/bin/bash
# Restore workspace layout from snapshot
# Copy this to restore-layout.sh and customize for your setup

WORKSPACE=${1:-3}  # Default to workspace 3
SNAPSHOT_FILE="$HOME/.config/hypr/layout-workspace${WORKSPACE}.json"

if [ ! -f "$SNAPSHOT_FILE" ]; then
    echo "No snapshot found at: $SNAPSHOT_FILE"
    echo "Run save-layout.sh first!"
    exit 1
fi

echo "Restoring layout for workspace ${WORKSPACE}..."

# Switch to the target workspace
hyprctl dispatch workspace ${WORKSPACE}

# Parse the snapshot and launch applications
jq -c '.[]' "$SNAPSHOT_FILE" | while read -r window; do
    CLASS=$(echo "$window" | jq -r '.class')
    TITLE=$(echo "$window" | jq -r '.title')

    echo "Launching: $CLASS ($TITLE)"

    case "$CLASS" in
        "chromium")
            hyprctl dispatch exec chromium &
            ;;
        "com.mitchellh.ghostty")
            # Check title to determine which terminal
            if echo "$TITLE" | grep -qi "irc"; then
                # Launch ghostty and auto-connect to IRC
                hyprctl dispatch exec "ghostty -e $HOME/.config/hypr/scripts/connect-irc.sh" &
            elif echo "$TITLE" | grep -qi "claude"; then
                # Launch claude terminal (customize as needed)
                hyprctl dispatch exec ghostty &
            elif echo "$TITLE" | grep -qi "YOUR_SERVER_NAME"; then
                # Launch SSH terminal (update with your server)
                hyprctl dispatch exec "ghostty -e ssh YOUR_USERNAME@YOUR_SERVER" &
            else
                # Default terminal
                hyprctl dispatch exec ghostty &
            fi
            ;;
        "todoist-wrapper")
            hyprctl dispatch exec todoist-wrapper &
            ;;
        "Spotify")
            hyprctl dispatch exec spotify &
            ;;
        *)
            echo "Unknown app class: $CLASS"
            ;;
    esac

    # Small delay between launches
    sleep 0.5
done

echo "Layout restoration complete!"
echo "Note: Windows will auto-arrange based on your Hyprland tiling rules"
